\subsection{Overlay Network}
The peer-to-peer network underlying Ethereum is maintained by means of the 
RLPx and the devp2p-Wire protocols.
The former is used for the exchange of packets between the peers and theirs
discovery, while the latter makes it possible to participate to the 
blockchain's consensus. Clearly, the former exploits the latter.

\subsubsection{RLPx}
According to its specification~\cite{}, the objective of RLPx is to
provide ``protocol suite which
provides a general-purpose transport and interface for applications to
communicate via a p2p network''.

\paragraph{Node discovery}
The RLPx node discovery is derived from the Kademlia protocol,
a distributed hash table (DHT) system ~\cite{bib:kademlia} 
based on the XOR-metric for 
distance, i.e. the distance between two keys $x$ and $y$ is given 
by $x \otimes y$.
In this system each node has an ID of 160-bit and maintains a
series of lists (one for each $i$ in $0 \leq i < 160$) of 
$\langle \verb|IP-Address|, \verb|UDP-Port|, \verb|Node ID| \rangle$ triples.
Each list contains contacts for nodes of distance between $2^i$ and $2^{i+1}$ 
from the node's ID.
Each list can contain at most $k$ elements and is therefore known as 
\textit{$k$-bucket}.
Each bucket is sorted by the time last
seen: in the head we find the least-recently seen node and at the end the most
recently ones.
When a node $R$ receives a message from a sender $S$. $R$ checks if the
$k$-bucket corresponding to the sender's ID (SID) already contains SID.
If it is the case SID is moved at the end of the list. Otherwise we should
distinguish two cases depending on whether the k-bucket is full or not.
In the former case $R$ pings the head ($H$) of the $k$-bucket and if
this responds, $S$ is discarded and $H$ is put at the end of the list,
otherwise $H$ is evicted and SID is inserted at the end of the list.
In the latter case the SID is simply inserted at the end of the list.

\todo{Describe kademlia with more details about xor...}
% Description of the PROTOCOL functions
This protocol is based on the four RPC functions \verb|PING|, \verb|FIND_NODE|,
\verb|STORE| and \verb|FIND_VALUE| and their replies.
In Kademlia \verb|STORE| and \verb|FIND_VALUE| are used to save a 
$\langle key, value\rangle$ pair in the DHT and later retrieve it, respectively.
Since these features are not needed for a pure node discovery, they
are not implemented in RLPx.
In RLPx there are only the \verb|PING| RPC, which is used to check whether a
node is still on-line or not and the \verb|FIND_NODE(ID)| call that is used to
retrieve the $k$ neighbors closest to the target \verb|ID|, known by the
recipient of the message. In the RLPx specification we can find also 
the \verb|PONG| and \verb|NEIGHBORS| instructions that are the reply messages
for \verb|PING| and \verb|FIND_NODE|, respectively.





\subsubsection{Devp2p-Wire}

